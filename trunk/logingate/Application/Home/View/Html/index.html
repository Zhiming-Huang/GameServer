<!DOCTYPE html>
<html>
<head>

    <title>萝卜兼职</title>

    <include file="Common/header"/>

</head>
<body>
    <div class="page-group">
        <div class="page page-current" id="index">
            <header class="bar bar-nav">
                <a class="button button-link button-nav pull-left" href="#chooseCity" data-panel='#chooseCity'>
                    <span class="iconf iconf-location"></span>威海
                </a>
                <h1 class='title'>萝卜兼职</h1>
                <a class="button button-link button-nav pull-right" href="#login">
                    <span class="iconf iconf-user02"></span>
                </a>
            </header>
            <div class="content infinite-scroll infinite-scroll-bottom bg_white" id="indexScroll" data-distance="100">
                <!-- 轮播图 -->
                <!-- <div class="wrap_banner"> -->
                    <div class="swiper-container swiper-container-horizontal" data-space-between="0">
                        <!-- <div class="swiper-wrapper">
                            <div class="swiper-slide swiper-slide-active" style="width: 375px; margin-right: 10px;">
                                <a href="javascript:void(0);">
                                    <img src="http://gqianniu.alicdn.com/bao/uploaded/i4//tfscom/i1/TB1n3rZHFXXXXX9XFXXXXXXXXXX_!!0-item_pic.jpg_640x640q60.jpg" alt="" style="width: 100%">
                                </a>
                            </div>
                            <div class="swiper-slide swiper-slide-next" style="width: 375px; margin-right: 10px;">
                                <img src="http://gqianniu.alicdn.com/bao/uploaded/i4//tfscom/i4/TB10rkPGVXXXXXGapXXXXXXXXXX_!!0-item_pic.jpg_640x640q60.jpg" alt="" style="width: 100%">
                            </div>
                            <div class="swiper-slide" style="width: 375px; margin-right: 10px;">
                                <img src="http://gqianniu.alicdn.com/bao/uploaded/i4//tfscom/i1/TB1kQI3HpXXXXbSXFXXXXXXXXXX_!!0-item_pic.jpg_640x640q60.jpg" alt="" style="width: 100%">
                            </div>
                        </div>
                        <div class="swiper-pagination">
                            <span class="swiper-pagination-bullet swiper-pagination-bullet-active"></span>
                            <span class="swiper-pagination-bullet"></span>
                            <span class="swiper-pagination-bullet"></span>
                        </div> -->
                    </div>    
                <!-- </div> -->
                <!-- 筛选条件，主标签 -->
                <div class="tabGroup pos_rela">
                    <div class="row no-gutter">
                        <div class="col-50 text-center pos_rela line_r" id="job_all">
                            <a class="f_left text-right" style="width: 55%;" onclick="redirectURL(1)" external>热门兼职</a>
                            <span class="i_jobHot f_left marg_left_20"></span>
                        </div>
                        <div class="col-50 text-center" id="job_new">
                            <a class="f_left text-right" style="width: 55%;" onclick="redirectURL(0)" external>最新兼职</a>
                            <span class="i_jobNew  f_left marg_left_20"></span>
                        </div>
                    </div>
                </div>
                <!-- 兼职列表数据 -->
                <div class="list-block">
                    <ul class="jobList list-container">
                        <li class="jobLi" iIndex="jobLi01">
                            <span class="iType cateId1">文本</span>
                            <div class="row no-gutter">
                                <div class="col-80 tx_ellips">
                                    PHP开发人员
                                </div>
                                <div class="col-20 text-center">
                                    <div class="bg_status bgGreen">
                                        <i class="i_triangle"></i>
                                        报名中
                                    </div>
                                </div>
                            </div>
                            <div class="row no-gutter">
                                <div class="col-66 fc_lightGray">
                                    <p class="f12 pos_rela">
                                        <span class="iconf iconf-location"></span>
                                        <span class="marg_left_10 tx_ellips pos_ab">威海高区</span>
                                    </p>
                                    <p class="f12 pos_rela">
                                        <span class="iconf iconf-clock"></span>
                                        <span class="marg_left_10 pos_ab">2015.01.12</span>
                                    </p>
                                </div>
                                <div class="col-33 text-right">
                                    <strong class="f12">电话咨询</strong>
                                    <small class="fc_lightGray">元/天</small>
                                </div>
                            </div>
                        </li>
                        <li class="jobLi" iIndex="jobLi01">
                            <span class="iType cateId2">服务员</span>
                            <div class="row no-gutter">
                                <div class="col-80 tx_ellips">
                                    PHP开发人员
                                </div>
                                <div class="col-20 text-center">
                                    <div class="bg_status bgOrg">
                                        <i class="i_triangle"></i>
                                        报名中
                                    </div>
                                </div>
                            </div>
                            <div class="row no-gutter">
                                <div class="col-66 fc_lightGray">
                                    <p class="f12 pos_rela">
                                        <span class="iconf iconf-location"></span>
                                        <span class="marg_left_10 tx_ellips pos_ab">威海高区</span>
                                    </p>
                                    <p class="f12 pos_rela">
                                        <span class="iconf iconf-clock"></span>
                                        <span class="marg_left_10 pos_ab">2015.01.12</span>
                                    </p>
                                </div>
                                <div class="col-33 text-right">
                                    <strong class="f12">电话咨询</strong>
                                    <small class="fc_lightGray">元/天</small>
                                </div>
                            </div>
                        </li>
                        <li class="jobLi" iIndex="jobLi01">
                            <span class="iType cateId3">其他</span>
                            <div class="row no-gutter">
                                <div class="col-80 tx_ellips">
                                    PHP开发人员
                                </div>
                                <div class="col-20 text-center">
                                    <div class="bg_status bgRed">
                                        <i class="i_triangle"></i>
                                        报名中
                                    </div>
                                </div>
                            </div>
                            <div class="row no-gutter">
                                <div class="col-66 fc_lightGray">
                                    <p class="f12 pos_rela">
                                        <span class="iconf iconf-location"></span>
                                        <span class="marg_left_10 tx_ellips pos_ab">威海高区</span>
                                    </p>
                                    <p class="f12 pos_rela">
                                        <span class="iconf iconf-clock"></span>
                                        <span class="marg_left_10 pos_ab">2015.01.12</span>
                                    </p>
                                </div>
                                <div class="col-33 text-right">
                                    <strong class="f12">电话咨询</strong>
                                    <small class="fc_lightGray">元/天</small>
                                </div>
                            </div>
                        </li>
                        <li class="jobLi" iIndex="jobLi01">
                            <span class="iType cateId4">文本</span>
                            <div class="row no-gutter">
                                <div class="col-80 tx_ellips">
                                    PHP开发人员
                                </div>
                                <div class="col-20 text-center">
                                    <div class="bg_status bgGreen">
                                        <i class="i_triangle"></i>
                                        报名中
                                    </div>
                                </div>
                            </div>
                            <div class="row no-gutter">
                                <div class="col-66 fc_lightGray">
                                    <p class="f12 pos_rela">
                                        <span class="iconf iconf-location"></span>
                                        <span class="marg_left_10 tx_ellips pos_ab">威海高区</span>
                                    </p>
                                    <p class="f12 pos_rela">
                                        <span class="iconf iconf-clock"></span>
                                        <span class="marg_left_10 pos_ab">2015.01.12</span>
                                    </p>
                                </div>
                                <div class="col-33 text-right">
                                    <strong class="f12">电话咨询</strong>
                                    <small class="fc_lightGray">元/天</small>
                                </div>
                            </div>
                        </li>
                        <li class="jobLi" iIndex="jobLi01">
                            <span class="iType cateId5">服务员</span>
                            <div class="row no-gutter">
                                <div class="col-80 tx_ellips">
                                    PHP开发人员
                                </div>
                                <div class="col-20 text-center">
                                    <div class="bg_status bgOrg">
                                        <i class="i_triangle"></i>
                                        报名中
                                    </div>
                                </div>
                            </div>
                            <div class="row no-gutter">
                                <div class="col-66 fc_lightGray">
                                    <p class="f12 pos_rela">
                                        <span class="iconf iconf-location"></span>
                                        <span class="marg_left_10 tx_ellips pos_ab">威海高区</span>
                                    </p>
                                    <p class="f12 pos_rela">
                                        <span class="iconf iconf-clock"></span>
                                        <span class="marg_left_10 pos_ab">2015.01.12</span>
                                    </p>
                                </div>
                                <div class="col-33 text-right">
                                    <strong class="f12">电话咨询</strong>
                                    <small class="fc_lightGray">元/天</small>
                                </div>
                            </div>
                        </li>
                        <li class="jobLi" iIndex="jobLi01">
                            <span class="iType cateId6">其他</span>
                            <div class="row no-gutter">
                                <div class="col-80 tx_ellips">
                                    PHP开发人员
                                </div>
                                <div class="col-20 text-center">
                                    <div class="bg_status bgRed">
                                        <i class="i_triangle"></i>
                                        报名中
                                    </div>
                                </div>
                            </div>
                            <div class="row no-gutter">
                                <div class="col-66 fc_lightGray">
                                    <p class="f12 pos_rela">
                                        <span class="iconf iconf-location"></span>
                                        <span class="marg_left_10 tx_ellips pos_ab">威海高区</span>
                                    </p>
                                    <p class="f12 pos_rela">
                                        <span class="iconf iconf-clock"></span>
                                        <span class="marg_left_10 pos_ab">2015.01.12</span>
                                    </p>
                                </div>
                                <div class="col-33 text-right">
                                    <strong class="f12">电话咨询</strong>
                                    <small class="fc_lightGray">元/天</small>
                                </div>
                            </div>
                        </li>
                        <li class="jobLi" iIndex="jobLi01">
                            <span class="iType cateId7">文本</span>
                            <div class="row no-gutter">
                                <div class="col-80 tx_ellips">
                                    PHP开发人员
                                </div>
                                <div class="col-20 text-center">
                                    <div class="bg_status bgGreen">
                                        <i class="i_triangle"></i>
                                        报名中
                                    </div>
                                </div>
                            </div>
                            <div class="row no-gutter">
                                <div class="col-66 fc_lightGray">
                                    <p class="f12 pos_rela">
                                        <span class="iconf iconf-location"></span>
                                        <span class="marg_left_10 tx_ellips pos_ab">威海高区</span>
                                    </p>
                                    <p class="f12 pos_rela">
                                        <span class="iconf iconf-clock"></span>
                                        <span class="marg_left_10 pos_ab">2015.01.12</span>
                                    </p>
                                </div>
                                <div class="col-33 text-right">
                                    <strong class="f12">电话咨询</strong>
                                    <small class="fc_lightGray">元/天</small>
                                </div>
                            </div>
                        </li>
                        <li class="jobLi" iIndex="jobLi01">
                            <span class="iType cateId8">服务员</span>
                            <div class="row no-gutter">
                                <div class="col-80 tx_ellips">
                                    PHP开发人员
                                </div>
                                <div class="col-20 text-center">
                                    <div class="bg_status bgOrg">
                                        <i class="i_triangle"></i>
                                        报名中
                                    </div>
                                </div>
                            </div>
                            <div class="row no-gutter">
                                <div class="col-66 fc_lightGray">
                                    <p class="f12 pos_rela">
                                        <span class="iconf iconf-location"></span>
                                        <span class="marg_left_10 tx_ellips pos_ab">威海高区</span>
                                    </p>
                                    <p class="f12 pos_rela">
                                        <span class="iconf iconf-clock"></span>
                                        <span class="marg_left_10 pos_ab">2015.01.12</span>
                                    </p>
                                </div>
                                <div class="col-33 text-right">
                                    <strong class="f12">电话咨询</strong>
                                    <small class="fc_lightGray">元/天</small>
                                </div>
                            </div>
                        </li>
                        <li class="jobLi" iIndex="jobLi01">
                            <span class="iType cateId9">其他</span>
                            <div class="row no-gutter">
                                <div class="col-80 tx_ellips">
                                    PHP开发人员
                                </div>
                                <div class="col-20 text-center">
                                    <div class="bg_status bgRed">
                                        <i class="i_triangle"></i>
                                        报名中
                                    </div>
                                </div>
                            </div>
                            <div class="row no-gutter">
                                <div class="col-66 fc_lightGray">
                                    <p class="f12 pos_rela">
                                        <span class="iconf iconf-location"></span>
                                        <span class="marg_left_10 tx_ellips pos_ab">威海高区</span>
                                    </p>
                                    <p class="f12 pos_rela">
                                        <span class="iconf iconf-clock"></span>
                                        <span class="marg_left_10 pos_ab">2015.01.12</span>
                                    </p>
                                </div>
                                <div class="col-33 text-right">
                                    <strong class="f12">电话咨询</strong>
                                    <small class="fc_lightGray">元/天</small>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <!-- 加载提示符 -->
                    <div class="infinite-scroll-preloader">
                        <div class="preloader"></div>
                    </div>
                </div>
                <!-- 底部版权信息 -->
                <footer class="text-center padd_20">
                    <p class="fc_orange f16">萝卜兼职网</p>
                    <p class="fc_orange f10">www.luobojianzhi.com</p>
                    <p class="f10">最靠谱的大学生兼职平台</p>
                </footer>
            </div>
        </div>
        <div class="panel-overlay"></div>

        <div class="page panel-left panel-cover" id="login">
            <header class="bar bar-nav">
                <a class="button button-link button-nav pull-left back toIndex" href="#index">
                    <span class="icon icon-left"></span>
                    返回
                </a>
                <h1 class="title">先登录</h1>
            </header>
            <div class="content">
                <p><a href="#index" class="close-panel">关闭</a></p>
            </div>
        </div>
    </div>

    <script type='text/javascript' src='//g.alicdn.com/sj/lib/zepto/zepto.min.js' charset='utf-8'></script>
    <script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm.min.js' charset='utf-8'></script>
    <script type='text/javascript' src='//g.alicdn.com/msui/sm/0.6.2/js/sm-extend.min.js' charset='utf-8'></script>
    
    <script type='text/javascript' src='__PUBLIC__/source/debug/scripts/template-debug.js' charset='utf-8'></script>

    <script type='text/javascript' src='__PUBLIC__/source/debug/scripts/swiper.js' charset='utf-8'></script>
</body>


<script>

    $(function () {

        // 加载flag
        var loading = false;
        // 最多可加载的条目
        var maxItems = 100;
        // 每次加载添加多少条目
        var pageSize = 5;

        function addItems(lastIndex, pageSize) {

        	console.log("lastIndex", lastIndex);

        	var currPage = lastIndex/pageSize;

        	console.log("currPage", currPage);

            $.ajax({

                type: 'POST',
                url: '/index.php/home/job/getJobsList',

                data: { "cId": '1', "currPage": currPage, "pageSize": pageSize },
                dataType: 'json',
                timeout: 3000,

                context: $('.jobList'),

                success: function(data){

                    if(data.code) {

                        var data = {
                            "jobs": data.data.data
                        };

                        console.log(data);

                        var html = template('job-list-tpl', data);
                        this.html(html);

                    } else {

                        this.append('<div class="padd_10 text-center">非常抱歉，暂无城市数据！</div>');

                    }
                },

                error: function(xhr, type){

                    this.append("非常抱歉，服务器开小差了！");
                    console.log("xhr", xhr);
                    console.log("type", type);

                }
            });

        }

        // 上次加载的序号
        var lastIndex = 5;

        //预先加载pageSize条数据
        addItems(lastIndex, pageSize);


        // 注册'infinite'事件处理函数
        $(document).on('infinite', '.infinite-scroll-bottom', function() {

            // 如果正在加载，则退出
            if (loading) return;

            // 设置flag
            loading = true;

            // 模拟1s的加载过程
            setTimeout(function() {
            
                // 重置加载flag
                loading = false;

                if (lastIndex >= maxItems) {

                    // 加载完毕，则注销无限加载事件，以防不必要的加载
                    $.detachInfiniteScroll($('.infinite-scroll'));

                    // 删除加载提示符
                    $('.infinite-scroll-preloader').remove();

                    return;
                }

                // 添加新条目
                addItems(lastIndex, pageSize);
                
                // 更新最后加载的序号
                lastIndex = $('.list-container li').length;

                //容器发生改变,如果是js滚动，需要刷新滚动
                $.refreshScroller();

            }, 1000);

        });      

        $.init();  
    });


</script>
<script id="banner-list-tpl" type="text/html">
    <div class="swiper-wrapper">
        {{each banners as banner i}}
            <div class="swiper-slide">
                {{if banner.linkurl == '' }} 
                <a href="javascript:void(0)">
                    <img src="{{#banner.image}}" alt="{{#banner.id}}">
                </a>
                {{else}} 
                <a href="{{banner.linkurl}}">
                    <img src="{{#banner.image}}" alt="{{#banner.id}}">
                </a>
                {{/if}}
            </div>
        {{/each}}
    </div>
    <div class="swiper-pagination"></div>
</script>
<script>
var cId = 1; //临时写死的城市id
    $(function() {
        // 请求banner
        $.ajax({
            type: 'POST',
            url: '/index.php/Home/sys/bannerList',
            data: { "cId": cId},
            dataType: 'json',
            timeout: 3000,
            context: $('.swiper-container'),

            success: function(data){

                if(data.code) {
                    var data = {
                        "banners": data.data
                    };
                    console.log(data);

                    var html = template('banner-list-tpl', data);
                    this.html(html);

                    var bannerLgt = data.length;
                    $.reinitSwiper(index);

                    $(".swiper-container").swiper({
                        pagination: (bannerLgt<= 1)?'':'.swiper-pagination',
                        paginationClickable: true,
                        spaceBetween: 0,
                        centeredSlides: true,
                        loop: (bannerLgt<= 1)?false:true,
                        autoplay: 3000,
                        autoplayDisableOnInteraction: false,
                        grabCursor: true
                    });
                } else {
                    $('.wrap_banner').hide();
                    // this.append("非常抱歉，暂无轮播图数据！");
                }
            },
            error: function(xhr, type){
                $('.wrap_banner').hide();
                console.log("xhr", xhr);
                console.log("type", type);
            }
        });
        
        });

    </script>

    </html>